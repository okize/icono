// Generated by CoffeeScript 1.6.3
var Q, fs, mime, svg2png, svgo, _;

fs = require('fs');

mime = require('mime');

_ = require('underscore');

Q = require('q');

svgo = new (require('svgo'))();

svg2png = require('svg2png');

module.exports = {
  encodeImage: function(data, type, format) {
    var encoded, formatMap;
    formatMap = {
      'svg': '\'data:image/svg+xml;base64,',
      'png': '\'data:image/png;base64,'
    };
    encoded = new Buffer(data).toString(type);
    return formatMap[format] + encoded + '\'';
  },
  roundNum: function(num) {
    return Math.round(num).toString();
  },
  trimExt: function(filename) {
    return filename.replace(/\.[^/.]+$/, '');
  },
  filterNonSvgFiles: function(files) {
    return _.filter(files, function(file) {
      return mime.lookup(file) === 'image/svg+xml';
    });
  },
  optimizeSvg: function(data) {
    var d;
    d = Q.defer();
    svgo.optimize(data, function(result) {
      if (result.error) {
        d.reject(new Error(result.error));
      }
      return d.resolve(result);
    });
    return d.promise;
  },
  saveSvgAsPng: function(inFile, outFile) {
    var d;
    d = Q.defer();
    svg2png(inFile, outFile, function(err) {
      if (err) {
        d.reject(new Error(err));
      }
      return d.resolve(outFile);
    });
    return d.promise;
  },
  createCss: function(results) {
    return results;
  }
};
