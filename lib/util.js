// Generated by CoffeeScript 1.6.3
var Q, encodeImage, filterNonSvgFiles, fs, isSvg, mime, saveSvgAsPng, svgo, trimExt, _;

fs = require('fs');

mime = require('mime');

_ = require('underscore');

Q = require('q');

svgo = new (require('svgo'))();

exports.encodeImage = encodeImage = function(file, type) {
  var bitmap;
  bitmap = fs.readFileSync(file);
  return new Buffer(bitmap).toString(type);
};

exports.saveSvgAsPng = saveSvgAsPng = function(data) {
  var d;
  d = Q.defer();
  svgo.optimize(data, function(result) {
    if (result.error) {
      d.reject(new Error(result.error));
    }
    return d.resolve(result);
  });
  return d.promise;
};

exports.trimExt = trimExt = function(filename) {
  return filename.replace(/\.[^/.]+$/, '');
};

exports.isSvg = isSvg = function(file) {
  return mime.lookup(file) === 'image/svg+xml';
};

exports.filterNonSvgFiles = filterNonSvgFiles = function(files) {
  return _.filter(files, function(file) {
    return isSvg(file);
  });
};
